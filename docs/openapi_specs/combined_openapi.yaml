openapi: 3.0.3
info:
  title: Distributed Notification System - Combined API
  description: Combined API documentation for the entire distributed notification system including API Gateway, User Service, Template Service, Email Service, and Push Service.
  version: 1.0.0
servers:
  - url: /api/v1
    description: API Gateway base URL
  - url: /v1/users
    description: User Service base URL
  - url: /v1/templates
    description: Template Service base URL

paths:
  /notifications:
    post:
      summary: Send a notification (email/push)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotificationRequest"
      responses:
        "200":
          description: Notification request accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnifiedResponse"

  /users/login:
    post:
      summary: User login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  example: zumma34@gmail.com
                password:
                  type: string
                  example: zumma126
              required:
                - email
                - password
      responses:
        "200":
          description: User logged in successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnifiedResponse"

  /users/register:
    post:
      summary: User registration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserRegisterRequest"
      responses:
        "201":
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnifiedResponse"

  /users/{user_id}:
    get:
      summary: Get user profile
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: User profile fetched
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnifiedResponse"

  /users/{user_id}/preferences:
    put:
      summary: Update user notification preferences
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserPreferences"
      responses:
        "200":
          description: Preferences updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnifiedResponse"

  /templates:
    post:
      summary: Create a new template
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TemplateRequest"
      responses:
        "201":
          description: Template created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnifiedResponse"
    get:
      summary: Get all templates
      responses:
        "200":
          description: List of templates
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnifiedResponse"

  /notifications/push:
    get:
      summary: Get all push notifications
      responses:
        "200":
          description: List of push notifications
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnifiedResponse"

  /notifications/push/{notification_id}:
    get:
      summary: Get push notification by ID
      parameters:
        - name: notification_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Push notification details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnifiedResponse"

  /health:
    get:
      summary: Health check for all services
      responses:
        "200":
          description: Service health status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: OK

components:
  schemas:
    NotificationRequest:
      type: object
      properties:
        notification_type:
          type: string
          enum: [email, push]
        request_id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        template_code:
          type: string
        variables:
          type: object
          additionalProperties:
            type: string
        priority:
          type: integer
      required:
        - notification_type
        - request_id
        - user_id
        - template_code
        - variables
        - priority

    UserRegisterRequest:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
        password:
          type: string
        push_token:
          type: string
        preferences:
          $ref: "#/components/schemas/UserPreferences"
      required:
        - name
        - email
        - password

    UserPreferences:
      type: object
      properties:
        email:
          type: boolean
        push:
          type: boolean

    TemplateRequest:
      type: object
      properties:
        template_key:
          type: string
        name:
          type: string
        description:
          type: string
        template_type:
          type: string
        subject:
          type: string
        body:
          type: string
        language:
          type: string
        variables:
          type: array
          items:
            type: string
      required:
        - template_key
        - name
        - template_type
        - subject
        - body
        - language
        - variables

    UnifiedResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
        error:
          type: string
          nullable: true
        message:
          type: string
        meta:
          type: object
          properties:
            total:
              type: integer
            limit:
              type: integer
            page:
              type: integer
            total_pages:
              type: integer
            has_next:
              type: boolean
            has_previous:
              type: boolean
